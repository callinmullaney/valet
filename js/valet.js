!function(t,e,i){"use strict";e.behaviors.valet={attach:function(i){t("body").once("valet").each(function(){var n=new e.valet.models.ValetModel;new e.valet.views.ValetView({el:t(i).find("#valet"),model:n})})}},e.valet=e.valet||{models:{},views:{}},e.valet.models.ValetModel=Backbone.Model.extend({defaults:{isOpen:!1}}),e.valet.views.ValetView=Backbone.View.extend({initialize:function(){var e=this;this.$input=this.$el.find(".valet-input"),this.$window=t(window),this.$body=t("body"),this.down=[],this.$el.find(".valet-close").click(this.toggle.bind(this)),this.$el.find(".valet-open").once().click(function(t){t.preventDefault(),e.toggle()}),_.bindAll(this,"keyDown"),_.bindAll(this,"keyUp"),t(document).bind("keydown",this.keyDown).bind("keyup",this.keyUp)},toggle:function(){var e=this;this.model.get("isOpen")?(this.$el.removeClass("open"),this.$body.removeClass("valet-open"),this.model.set("isOpen",!1),""!==this.$input[0].value&&setTimeout(function(){e.$el.addClass("hideInput"),setTimeout(function(){e.$el.removeClass("hideInput"),e.$input[0].value=""},300)},500),this.$input[0].blur(),this.$window.off("click.valet-link")):(this.$input.val("").attr("disabled",!1),this.getData(this.autoComplete.bind(this)),this.$el.addClass("open"),this.$body.addClass("valet-open"),this.model.set("isOpen",!0),this.$input.focus(),setTimeout(function(){e.$window.on("click.valet-link",function(i){t(i.target).closest(".valet-inner").length||e.toggle()})},300))},autoComplete:function(e){var i=this;this.$input.once("valet").autocomplete({appendTo:"#valet-results",minLength:1,delay:0,autoFocus:!0,source:e,focus:function(t,e){return!1},select:function(t,e){if(e.item)return i.go(e.item.label,e.item.value),!1}}).autocomplete("instance")._renderItem=function(e,i){var n=i.value.length>85?i.value.substring(0,85)+"...":i.value.length>0?i.value:"/";return t("<li></li>").append("<a><strong>"+i.label+"</strong> <small>"+n+"</small><br><em>"+i.description+"</em></a>").appendTo(e)}},go:function(t,e){e=e.replace("RETURN_URL",window.location.pathname.substring(1)),this.down[16]?(this.down[16]=!1,this.toggle(),window.open(e)):(this.$input.val("Loading...").attr("disabled",!0),window.location=e)},getData:function(e){var n=this,a=localStorage?JSON.parse(localStorage.getItem("valet")):null;return a&&i.valet.cache&&a.timestamp>=i.valet.cache?e(a.data):(n.$input.val("Loading data...").attr("disabled",!0),void t.ajax({url:i.path.baseUrl+"api/valet",dataType:"json",success:function(t){if(n.$input.val("").attr("disabled",!1).focus(),localStorage){var i=Math.floor((new Date).getTime()/1e3);localStorage.setItem("valet",JSON.stringify({timestamp:i,data:t}))}return e(t)},error:function(t,i,n){return alert(t.status),alert(n),e(null)}}))},keyDown:function(e){return this.model.get("isOpen")&&27===e.keyCode?void this.toggle():(this.down[e.keyCode]=!0,void(this.down[i.valet.hotkey]&&this.down[i.valet.modifier]&&!t(e.target).is(":focus")&&(e.preventDefault(),this.toggle())))},keyUp:function(t){this.down[t.keyCode]=!1}})}(jQuery,Drupal,drupalSettings);
//# sourceMappingURL=valet.js.map
