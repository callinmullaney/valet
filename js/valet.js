!function(e,t,i){"use strict";t.behaviors.valet={attach:function(i){e("body").once("valet").each(function(){var a=new t.valet.models.ValetModel;new t.valet.views.ValetView({el:e(i).find("#valet"),model:a})})}},t.valet=t.valet||{models:{},views:{}},t.valet.models.ValetModel=Backbone.Model.extend({defaults:{isOpen:!1}}),t.valet.views.ValetView=Backbone.View.extend({initialize:function(){this.$input=this.$el.find(".valet-input"),this.down=[],this.$el.find(".valet-close").click(this.toggle.bind(this)),_.bindAll(this,"keyDown"),_.bindAll(this,"keyUp"),e(document).bind("keydown",this.keyDown).bind("keyup",this.keyUp)},toggle:function(){var t=this;this.model.get("isOpen")?(e(this.$el.removeClass("open")),this.model.set("isOpen",!1),""!==this.$input[0].value&&setTimeout(function(){t.$el.addClass("hideInput"),setTimeout(function(){t.$el.removeClass("hideInput"),t.$input[0].value=""},300)},500),this.$input[0].blur()):(this.$input.val("").attr("disabled",!1),this.getData(this.autoComplete.bind(this)),e(this.$el.addClass("open")),this.model.set("isOpen",!0),this.$input.focus())},autoComplete:function(t){var i=this;this.$input.once("valet").autocomplete({appendTo:"#valet-results",minLength:1,delay:0,autoFocus:!0,source:t,focus:function(e,t){return!1},select:function(e,t){if(t.item)return i.go(t.item.label,t.item.value),!1}}).autocomplete("instance")._renderItem=function(t,i){var a=i.value.length>85?i.value.substring(0,85)+"...":i.value.length>0?i.value:"/";return e("<li></li>").append("<a><strong>"+i.label+"</strong> <small>"+a+"</small><br><em>"+i.description+"</em></a>").appendTo(t)}},go:function(e,t){t=t.replace("RETURN_URL",window.location.pathname.substring(1)),this.down[16]?(this.down[16]=!1,this.toggle(),window.open(t)):(this.$input.val("Loading...").attr("disabled",!0),window.location=t)},getData:function(t){var a=this,n=localStorage?JSON.parse(localStorage.getItem("valet")):null;return n&&i.valet.cache&&n.timestamp>=i.valet.cache?t(n.data):(a.$input.val("Loading data...").attr("disabled",!0),void e.ajax({url:i.path.baseUrl+"api/valet",dataType:"json",success:function(e){if(a.$input.val("").attr("disabled",!1).focus(),localStorage){var i=Math.floor((new Date).getTime()/1e3);localStorage.setItem("valet",JSON.stringify({timestamp:i,data:e}))}return t(e)},error:function(e,i,a){return alert(e.status),alert(a),t(null)}}))},keyDown:function(t){return this.model.get("isOpen")&&27===t.keyCode?void this.toggle():(this.down[t.keyCode]=!0,void(this.down[i.valet.hotkey]&&this.down[i.valet.modifier]&&!e(t.target).is(":focus")&&(t.preventDefault(),this.toggle())))},keyUp:function(e){this.down[e.keyCode]=!1}})}(jQuery,Drupal,drupalSettings);
//# sourceMappingURL=valet.js.map
