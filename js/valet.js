!function(t,e,i){"use strict";function n(e,i){var n=new RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return n.test(t.command)||n.test(t.label)||n.test(t.value)})}var o=t.ui.autocomplete.prototype,a=o._initSource;t.extend(o,{_initSource:function(){t.isArray(this.options.source)?this.source=function(t,e){e(n(this.options.source,t.term))}:a.call(this)}}),e.behaviors.valet={attach:function(i){t("body").once("valet").each(function(){var n=new e.valet.models.ValetModel;new e.valet.views.ValetView({el:t(i).find("#valet"),model:n})})}},e.valet=e.valet||{models:{},views:{}},e.valet.models.ValetModel=Backbone.Model.extend({defaults:{isOpen:!1}}),e.valet.views.ValetView=Backbone.View.extend({initialize:function(){var e=this;this.$input=this.$el.find(".valet-input"),this.$window=t(window),this.$body=t("body"),this.$results=t("#valet-results"),this.down=[],this.$el.find(".valet-close").click(this.toggle.bind(this)),this.$el.find(".valet-open-link").click(function(t){t.preventDefault(),e.toggle()}),this.timeout=null,_.bindAll(this,"keyDown"),_.bindAll(this,"keyUp"),t(document).bind("keydown",this.keyDown).bind("keyup",this.keyUp),t(".valet-trigger").click(function(t){t.preventDefault(),e.toggle()}),this.$input.autocomplete({appendTo:this.$results,minLength:1,delay:0,autoFocus:!0,search:function(t,i){e.$results.addClass("searching")},response:function(t,i){clearTimeout(e.timeout),e.timeout=setTimeout(function(){e.$results.removeClass("searching")},10)},focus:function(t,e){return!1},select:function(t,i){if(i.item)return e.go(i.item.label,i.item.value),!1}}),this.$input.autocomplete("instance")._renderItem=function(e,i){var n=i.value.length>0?i.value:"/";n=i.value.length>85?i.value.substring(0,85)+"...":n;var o=i.icon?'<i class="'+i.icon+'"></i>':"";return t("<li></li>").append("<a>"+o+"<strong>"+i.label+"</strong><em>"+i.description+"</em><small>"+n+"</small></a>").appendTo(e)},this.$input.autocomplete("instance")._renderMenu=function(e,i){var n=this;i=i.slice(0,6),t.each(i,function(t,i){n._renderItemData(e,i)})}},toggle:function(){var e=this;this.model.get("isOpen")?(this.$el.removeClass("open"),this.$body.removeClass("valet-open"),this.model.set("isOpen",!1),""!==this.$input[0].value&&setTimeout(function(){e.$el.addClass("hideInput"),setTimeout(function(){e.$el.removeClass("hideInput"),e.$input[0].value=""},300)},500),this.$input[0].blur(),this.$window.off("click.valet-link")):(this.$input.val("").attr("disabled",!1),this.getData(this.autoComplete.bind(this)),this.$el.addClass("open"),this.$body.addClass("valet-open"),this.model.set("isOpen",!0),this.$input.focus(),setTimeout(function(){e.$window.on("click.valet-link",function(i){t(i.target).closest(".valet-inner").length||e.toggle()})},300))},autoComplete:function(t){this.$input.autocomplete("option",{source:t})},go:function(t,e){e=e.replace("RETURN_URL",window.location.pathname.substring(1)),this.down[16]?(this.down[16]=!1,this.toggle(),window.open(e)):(this.$input.val("Loading...").attr("disabled",!0),window.location=e)},getData:function(e){var n=this,o=localStorage?JSON.parse(localStorage.getItem("valet")):null;return o&&i.valet.cache&&o.timestamp>=i.valet.cache?e(o.data):(n.$input.val("Loading data...").attr("disabled",!0),void t.ajax({url:i.path.baseUrl+"api/valet",dataType:"json",success:function(t){if(n.$input.val("").attr("disabled",!1).focus(),localStorage){var i=Math.floor((new Date).getTime()/1e3);localStorage.setItem("valet",JSON.stringify({timestamp:i,data:t}))}return e(t)},error:function(t,i,n){return alert(t.status),alert(n),e(null)}}))},keyDown:function(e){return this.model.get("isOpen")&&27===e.keyCode?void this.toggle():(this.down[e.keyCode]=!0,void(this.down[i.valet.hotkey]&&this.down[i.valet.modifier]&&!t(e.target).is(":focus")&&(e.preventDefault(),this.toggle())))},keyUp:function(t){this.down[t.keyCode]=!1}})}(jQuery,Drupal,drupalSettings);